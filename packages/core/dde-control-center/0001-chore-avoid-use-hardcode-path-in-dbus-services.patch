From b67c84002557701e689d976fb7877536a18e9c3f Mon Sep 17 00:00:00 2001
From: rewine <luhongxu@deepin.org>
Date: Mon, 29 May 2023 13:43:58 +0800
Subject: [PATCH] chore: avoid use hardcode path in dbus services

Log: avoid use hardcode path in dbus services
---
 CMakeLists.txt                                | 7 ++++++-
 misc/org.deepin.dde.ControlCenter1.service    | 3 ---
 misc/org.deepin.dde.ControlCenter1.service.in | 3 +++
 3 files changed, 9 insertions(+), 4 deletions(-)
 delete mode 100644 misc/org.deepin.dde.ControlCenter1.service
 create mode 100644 misc/org.deepin.dde.ControlCenter1.service.in

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 8ff4f2d5c..73c505a05 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -246,7 +246,12 @@ install(FILES ${QM_FILES} DESTINATION ${TRANSLATE_INSTALL_DIR})
 install(FILES misc/dde-control-center.desktop DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/applications)
 
 #service
-install(FILES misc/org.deepin.dde.ControlCenter1.service DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/dbus-1/services)
+configure_file(
+    ${CMAKE_SOURCE_DIR}/misc/org.deepin.dde.ControlCenter1.service.in 
+    ${CMAKE_CURRENT_BINARY_DIR}/org.deepin.dde.ControlCenter1.service 
+    @ONLY)
+install(FILES ${CMAKE_CURRENT_BINARY_DIR}/org.deepin.dde.ControlCenter1.service 
+        DESTINATION ${CMAKE_INSTALL_DATAROOTDIR}/dbus-1/services)
 
 # dev files
 file(GLOB HEADERS "include/*")
diff --git a/misc/org.deepin.dde.ControlCenter1.service b/misc/org.deepin.dde.ControlCenter1.service
deleted file mode 100644
index 90b85519a..000000000
--- a/misc/org.deepin.dde.ControlCenter1.service
+++ /dev/null
@@ -1,3 +0,0 @@
-[D-BUS Service]
-Name=org.deepin.dde.ControlCenter1
-Exec=/usr/bin/dde-control-center -d
diff --git a/misc/org.deepin.dde.ControlCenter1.service.in b/misc/org.deepin.dde.ControlCenter1.service.in
new file mode 100644
index 000000000..91294f7ad
--- /dev/null
+++ b/misc/org.deepin.dde.ControlCenter1.service.in
@@ -0,0 +1,3 @@
+[D-BUS Service]
+Name=org.deepin.dde.ControlCenter1
+Exec=@CMAKE_INSTALL_FULL_BINDIR@/dde-control-center -d
-- 
2.40.1

